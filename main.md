Śledzie
================
Marcin Leśnierowski, Bartosz Nawrotek
9 12 2019

## R Markdown

``` r
### Set seed to make experiment reproducible
set.seed(123)
n <- 1000
```

## Set working dir to script level

current\_working\_dir \<-
dirname(rstudioapi::getActiveDocumentContext()$path)
setwd(current\_working\_dir)

## Load dataset

``` r
sledz_data <- read.csv("res/sledzie.csv", stringsAsFactors = FALSE)
```

### Print the Dimension of dataset

``` r
dim(sledz_data)
```

    ## [1] 52582    16

# Exclude the missing observations

``` r
idx <- sledz_data == "?"
is.na(sledz_data) <- idx
sledz_data <-sledz_data %>%
na.omit()       
dim(sledz_data) 
```

    ## [1] 42488    16

### Head of 5 first rows (to illustrate how does it looks like)

``` r
head(select(sledz_data, 1:ncol(sledz_data)))
```

    ##   X length   cfin1   cfin2   chel1    chel2   lcop1    lcop2  fbar   recr
    ## 2 1   22.5 0.02778 0.27785 2.46875 21.43548 2.54787 26.35881 0.356 482831
    ## 3 2   25.0 0.02778 0.27785 2.46875 21.43548 2.54787 26.35881 0.356 482831
    ## 4 3   25.5 0.02778 0.27785 2.46875 21.43548 2.54787 26.35881 0.356 482831
    ## 5 4   24.0 0.02778 0.27785 2.46875 21.43548 2.54787 26.35881 0.356 482831
    ## 7 6   24.0 0.02778 0.27785 2.46875 21.43548 2.54787 26.35881 0.356 482831
    ## 8 7   23.5 0.02778 0.27785 2.46875 21.43548 2.54787 26.35881 0.356 482831
    ##        cumf   totaln           sst      sal xmonth nao
    ## 2 0.3059879 267380.8 14.3069330186 35.51234      7 2.8
    ## 3 0.3059879 267380.8 14.3069330186 35.51234      7 2.8
    ## 4 0.3059879 267380.8 14.3069330186 35.51234      7 2.8
    ## 5 0.3059879 267380.8 14.3069330186 35.51234      7 2.8
    ## 7 0.3059879 267380.8 14.3069330186 35.51234      7 2.8
    ## 8 0.3059879 267380.8 14.3069330186 35.51234      7 2.8

## Data sampling

## Data info

### Mean

``` r
s_mean <- summarise_each(sledz_data, funs(mean))
s_mean
```

    ##          X  length cfin1 cfin2 chel1 chel2 lcop1 lcop2     fbar     recr
    ## 1 26105.41 25.2807    NA    NA    NA    NA    NA    NA 0.323243 524483.7
    ##        cumf   totaln sst      sal xmonth      nao
    ## 1 0.2261864 512444.4  NA 35.50834  7.321 -0.12111

### Std

``` r
s_std <- summarise_each(sledz_data, funs(sd))
s_std
```

    ##          X   length     cfin1    cfin2    chel1    chel2   lcop1    lcop2
    ## 1 15100.83 1.691182 0.9094429 3.541257 13.71666 10.32743 14.5692 13.75499
    ##        fbar     recr       cumf   totaln       sst        sal   xmonth     nao
    ## 1 0.1619752 272398.2 0.09221074 223700.7 0.4462298 0.03846228 2.717599 2.20181

### Min

``` r
s_min <- summarise_each(sledz_data, funs(min))
s_min
```

    ##    X length cfin1 cfin2 chel1    chel2   lcop1    lcop2  fbar   recr       cumf
    ## 1 22   20.5     0     0     0 10.10963 0.30741 10.72889 0.068 140515 0.06832592
    ##     totaln           sst      sal xmonth   nao
    ## 1 144136.7 12.7690663857 35.39803      1 -4.89

### Max

``` r
s_max <- summarise_each(sledz_data, funs(max))
s_max
```

    ##       X length   cfin1   cfin2   chel1   chel2   lcop1   lcop2  fbar    recr
    ## 1 52555   29.5 4.83333 6.52884 9.66667 9.43208 9.02247 9.17171 0.849 1380210
    ##        cumf  totaln           sst     sal xmonth  nao
    ## 1 0.3980148 1015595 14.7294663426 35.6124     12 5.08

## Correration

``` r
sledz_num = sapply( sledz_data, as.numeric )
cor_mat <- sledz_num[, 1:ncol(sledz_num)]
cor_mat = cor(cor_mat)

corrplot(cor_mat, method="circle")
```

![](main_files/figure-gfm/unnamed-chunk-11-1.png)<!-- -->

## Interactive picture

<input type="range" min="1" max=1000 value=cur class="slider" id="myRange">
<img src="res/ryba.jpg" alt="ryba" width=10*sledz_data[1,2] id="ryba"/>
<input id="current_idx" type="text" value="">

<script>
var slider = document.getElementById("myRange");
sizes = ([26.5,23,24,23,25.5,22.5,28,22.5,27,27.5,24,26.5,24.5,23.5,26,22.5,26,25.5,29.5,22,22.5,27,21.5,24.5,25,27,27.5,27,26,26.5,25,23,26,25.5,26,27,26,27.5,24.5,27.5,23,24.5,23.5,27.5,25.5,25,25.5,24.5,28.5,24.5,28,27.5,25,25.5,25,27,25.5,26.5,21.5,25,24.5,26,25,26,25.5,27.5,25.5,24,24.5,28.5,26.5,23.5,27,21,27,26,26.5,26.5,27.5,27,25.5,26,23.5,23.5,25,26,25,24,23.5,23.5,23.5,25,26.5,22.5,26.5,25.5,24,27,26.5,28.5,29,28.5,28.5,22.5,28.5,23,24.5,23,27,25,22.5,26.5,22,25,26,24,25,24.5,25,28.5,24.5,26.5,29,25,25,24.5,27,28.5,26.5,26.5,25.5,23.5,27.5,24.5,28,24,24.5,25,23.5,26.5,28,25,26,27,23,28,26,27,26,25,24,27.5,26,27.5,27,27.5,24.5,25,27.5,28.5,27,27.5,25,26,29.5,23,25.5,25.5,24.9,25.5,24.5,26.5,26,21.5,24.5,26.5,28,26.5,23,23.5,24.5,27.5,25,27,23.5,24.5,25.5,26.5,24,23.5,27.5,27.5,23,26.5,26,25.5,26,25.5,24.5,25,26.5,24.5,27,27,27.5,24,26,26,22,24,21.5,28,28,26,25,25.5,26,29,24.5,23.5,27.5,23,24,24.5,24,24.5,26.5,26.5,25.5,24,26.5,23.5,27.5,23,27.5,26.5,25,23.5,24.5,24.5,25.5,24.5,25,23.5,29,23,25.5,24,23.5,24.5,25.5,25.5,25,26.5,26,22.5,26.5,25,25,24,25,24,25.5,23,24.5,25,28,27.5,26,25,24.5,23.5,23,25.5,24,25,24,24,26.5,24.5,24.5,27,27,27,24,23.5,25,26,24.5,23.5,26,20.5,27.5,22.5,23.5,23.5,23.5,25,26.5,25,24,22.5,26.5,25.5,22,25,24,24.5,27.5,27,25.5,25.5,23.5,25.5,26,24,24,25.5,28,22,23,25.5,26.5,25,25.5,25,24,26,27,26,26,25,24.5,24.5,27.5,26.5,26.5,25,24,25,24.2,24.5,23.5,25,26,26,24,26.5,27.5,26,27.5,25,22,26.5,27,24.5,25,26,27.5,24.5,26,26.5,23.5,28,27.5,25,26.5,24.5,29,25,25.5,28,25,28,23.5,22,25.5,27.5,28,23,27,24,27,22.5,22.5,22.5,25.5,26,26.5,28.5,24.5,29,25,26,26,26.5,27.5,25,25.5,22,22.5,25.5,23,25.5,27,27.5,23,24,25,24,27.5,24,24.5,28,27,25,23,28.5,26.5,24.5,26.5,24,24.5,26.5,22.5,25,25.5,26,25.5,26,21.5,25.5,25,23.5,25,25,23.5,27,27,26.5,26,26,26.5,28.5,26,26,26.5,24.5,28,24.5,27,27.5,23,25.5,25,23.5,24.5,23,23.5,24.5,23,26.5,24,28,26,28,27.5,23.5,27.5,24.5,23.5,25,23.5,22,24,28,23.5,22.5,27,24.5,26,26,24,23,23,25.5,27.5,27.5,25,25.5,21,27,28.5,27,27,24,25.5,24,26.5,24,28,26.5,28,26,29,27,28,27,24.5,28.5,26,25.5,22,27,24.5,22.5,26.5,23,24.5,21.5,24.5,27,27.5,25,27,24.5,23,24.5,24,27,26,25,22.5,24.5,22,23.5,27,24.5,22,26,24,27.5,26.5,26.5,25,22.5,26.5,21.5,25,24.5,27,27,27,24.5,26,26,22,26.5,26,25,25,24,22.5,26,23.5,25.5,26.5,26,27,24,27.5,23.5,26,23.5,24.5,26.5,25,21.5,23.5,25.5,25.5,22,23.5,27.5,24.5,26.5,26.5,25,24,27,23.5,24.5,23.5,26,25.5,23.5,24,29,24.5,24,26,23,24,26.5,25,25.5,25,24,27,26.5,25.5,25,26.5,24.5,25.5,24.5,23,25,23.5,26,25.5,23,25.5,26,22.5,28,26.5,23,27.5,27.5,23,25,21.5,26,24,25,24,25.5,24,23.8,26,24,24.5,26,25,26,24.5,24.5,28.5,27,22,25,25,26.5,25.5,26,23.5,25.5,28.5,28.5,24,23,27,25.5,26.5,26,22,26.5,23,26.5,26.5,23.5,26.5,27,23,25.5,23,25,26,26,25,24.5,23,22.5,25.5,25,24,27.5,23,26.5,23,27,23.5,26,28.5,25.5,26.5,25,23,26.5,25,25.5,26.5,25,27.5,25.5,25.5,26.5,28.5,22.5,26.5,22.5,27.5,25.5,24,26.5,25,24,23,26.5,23.8,21,24.5,25,25,27,25.5,22.5,25.5,25.5,25.5,24,24.5,25.5,26.5,29.5,24.5,24,28,23.5,24.5,27.5,26,27,28.5,28,21.5,25.5,24,24.5,26,26.5,23.5,26,25.5,26,28,24,27.5,25.5,27.5,24.5,26.5,25,25.5,24.5,25.5,28.5,26,23,25,26.5,26.5,24.5,25.5,27,27.5,24.5,24,22.5,25,22,26.5,25.5,23.5,26,25.5,24,24.5,23.5,23,24.5,25,28.5,22.5,26.5,26.5,26,26,25.5,23,29.5,25.5,27.5,26.5,24,24.5,24,24.5,24,27,26.5,25.5,24.5,23.5,25,28.5,26.5,23,26,24.5,26.5,27,25,24.5,25.5,25,26.5,27.5,24,23.5,23,28.5,25,23,25,23.5,23,27,27,23,25,26.5,26,27,27,24.5,24.5,26.5,25.5,26,24.5,23.5,25.5,29,22.5,24,25.5,26,22.5,24,22.5,25,26.5,26.5,26,24.5,25.5,23.5,26,27.5,26,23.5,25,22.5,26,26,25,25.5,24.5,25.5,24.5,25.5,24.5,24.5,27,26.5,25.5,27,25,26,24.5,24.5,25,23.5,26,26.5,25.5,26,24.5,22,25,25,26,23.5,26,23.5,25.5,24.5,26,24,23.5,24.5,24.5,25.5,22.5,25,22.5,26.5,28,24,25.5,27.5,25,26.5,24.5,27,23.5,26.5,25.5,24,26,26,26,22,27.5,28.5,23,24,24.5,23,23,26.5,25,25,26,27.5,28.5,25.5,26.5,24.5,26.5,24.5,24.5,27.5,25.5,22.5,22.5,24.5,21.5,25,26.5,27.5,24,25.5,27,24.5,24.5,25,27,27,23,25,23,23.5,25,23.5,23,28.5,28,28,25,21.5,26.5,23,24,24,27.5,26,25,23,26.5,23.5,27.5,28.5,24.5,25.5,26.5,24,23])

slider.oninput = function() {
  cur = slider.value; 
  var s = document.getElementById('current_idx');
  
  step = sizes.length/1000
  size = sizes.slice(step * cur, step * cur+1)
  size = size.reduce((a,b) => a + b, 0)
  size = size/step
  
  s.value = 'pozycja: ' + cur + '\t rozmiar: ' + size;
  
  var ryba = document.getElementById('ryba');
  ryba.width = size*10
}
</script>

# Regression

``` r
sledz_num = sapply(sledz_origin, as.numeric )
#sledz_num  <- as.data.frame(t(sledz_num ))

smp_size <- floor(0.75 * nrow(sledz_num))

train_ind <- sample(seq_len(nrow(sledz_num)), size = smp_size)

ctrl <- trainControl(
  method = "repeatedcv",
  number = 2,
  repeats = 5
)

train_data <- sledz_num[train_ind, ]
test_data <- sledz_num[-train_ind, ]

model <- train(length ~ .,
               data = train_data,
               method = "gbm",
               trControl = ctrl,
               verbose= FALSE
)

model
```

    ## Stochastic Gradient Boosting 
    ## 
    ## 31866 samples
    ##    15 predictor
    ## 
    ## No pre-processing
    ## Resampling: Cross-Validated (2 fold, repeated 5 times) 
    ## Summary of sample sizes: 15933, 15933, 15934, 15932, 15933, 15933, ... 
    ## Resampling results across tuning parameters:
    ## 
    ##   interaction.depth  n.trees  RMSE      Rsquared   MAE      
    ##   1                   50      1.274680  0.4171034  1.0132033
    ##   1                  100      1.231606  0.4452925  0.9770001
    ##   1                  150      1.213673  0.4589886  0.9618770
    ##   2                   50      1.210429  0.4645790  0.9611143
    ##   2                  100      1.181415  0.4862005  0.9363660
    ##   2                  150      1.169488  0.4957279  0.9259765
    ##   3                   50      1.183617  0.4858492  0.9381123
    ##   3                  100      1.162456  0.5018925  0.9203146
    ##   3                  150      1.153493  0.5091558  0.9125777
    ## 
    ## Tuning parameter 'shrinkage' was held constant at a value of 0.1
    ## 
    ## Tuning parameter 'n.minobsinnode' was held constant at a value of 10
    ## RMSE was used to select the optimal model using the smallest value.
    ## The final values used for the model were n.trees = 150, interaction.depth =
    ##  3, shrinkage = 0.1 and n.minobsinnode = 10.

``` r
 #test_data["length"]
 
 #test_data  <- as.data.frame(t(test_data))
 
predictions <- predict(model, test_data)
```

# Model summary

``` r
summary(model$finalModel)
```

![](main_files/figure-gfm/unnamed-chunk-13-1.png)<!-- -->

    ##           var    rel.inf
    ## sst       sst 45.2812070
    ## X           X 15.5540080
    ## recr     recr 10.6136013
    ## fbar     fbar  7.2302683
    ## cfin1   cfin1  3.5858268
    ## totaln totaln  3.2452544
    ## cumf     cumf  2.7258951
    ## lcop1   lcop1  2.7117596
    ## lcop2   lcop2  2.3824469
    ## xmonth xmonth  2.0072845
    ## chel2   chel2  1.8778107
    ## cfin2   cfin2  1.4443517
    ## nao       nao  0.7194605
    ## sal       sal  0.5120589
    ## chel1   chel1  0.1087663
